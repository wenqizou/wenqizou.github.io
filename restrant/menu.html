<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>å’Œç…¦</title>
    <script src="./jq.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inconsolata:wght@300&family=Nanum+Gothic&family=Raleway:wght@100&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="./fonts/stylesheet.css" />
    <link rel="stylesheet" href="./stylemenu.css" />
  </head>
  <body>
    <div class="layout-container">
      <header class="layout-header">
        <nav class="navlist topmenu">
          <a class="menu-1" href="/menu">ORDER</a>
          <a class="menu-2">RESERVATION</a>
          <a class="menu-6">MENU</a>
          <a class="menu-4">EVENT</a>
          <a class="menu-5">CATERING</a>
          <a class="menu-3">GIFT CARD</a>
        </nav>
        <!-- <nav class="navlist topmenu">
          <a class="Layout_activeNavLink__2i0qW" href="/menu">Menu</a>
          <a class="">Order Now</a>
          <a href="">Reservation</a>
          <a href="">Events</a>
          <a href="">Catering</a>
          <a href="">Gift Card</a>
        </nav> -->
        <div class="menu-toggle">
          <div></div>
          <div></div>
          <div></div>
        </div>
        <a href="/index"><div class="logo"></div></a>
      </header>
      <main class="layout-body">
        <aside class="menu_categoryNav">
          <!-- fetch json get  -->
          <nav class="navlink" id="navLink">
            <div class="categoryLink">
              <a href="#Beerå•¤é…’">Beer å•¤é…’</a>
            </div>
            <!-- <div class="categoryLink">
              <a href="#Sakeæ¸…é…’">Sake æ¸…é…’</a>
            </div>-->
          </nav>
        </aside>
        <div id="main-body"></div>
        <aside class="menu_categoryNav_bottom">
          <nav class="navlink_bottom" id="navlink_bottom"></nav>
        </aside>
      </main>
      <footer>
        <div class="pc-footer-left">
          <div class="text-1">
            <p>
              Mon - Thur<br />
              12 â€“ 3:30pm<br />
              5 â€“ 10pm
            </p>
            <p>
              Fri - Sat<br />
              12 â€“ 10:30pm
            </p>
            <p>
              Sun<br />
              12 â€“ 10pm
            </p>
          </div>
          <div class="text-2">
            <p>
              Lunch Special<br />
              12 â€“ 3:30pm<br />
              Monday to Friday
            </p>
            <p>
              Happy Hour ðŸ¥‚<br />
              12 â€“ 6pm
            </p>
          </div>
        </div>
        <div class="pc-footer-center">
          <p class="link-a">
            <a
              target="_blank"
              href="https://www.google.com/maps/place/Breeze/@40.7230058,-73.9531898,17z/data=!3m1!4b1!4m6!3m5!1s0x89c25970c517236b:0x2d75b68e8f548dab!8m2!3d40.7230018!4d-73.9506149!16s%2Fg%2F11vbjff2zs?entry=ttu"
              >595 Manhattan Ave, Brooklyn, NY, 11222</a
            >
          </p>
          <p class="link-a"><a href="tel://212-718-0797">212-718-0797</a></p>
          <p class="link-a">
            <a href="mailto:hytaodesign@gmail.com">Service@breezebk.com</a>
          </p>
        </div>
        <div class="pc-footer-right">
          <p>Work with us</p>
          <div class="ins">
            <a target="_blank" href="https://www.instagram.com/breezehexu/"
              ><img src="./images/ins-mobile.png" alt="" width="60"
            /></a>
          </div>
          <p>
            Website Design by<br />
            Hanyu Tao<br />
            (hytaodesign@gmail.com)
          </p>
        </div>
      </footer>
    </div>
  </body>
</html>
<script>
  function uniqueFunc(arr, uniId) {
    const res = new Map()
    return arr.filter(
      (item) => !res.has(item[uniId]) && res.set(item[uniId], 1)
    )
  }
  function menuBycategory(arr, category) {
    return arr.filter((e) => e.category == category)
  }
  function joinMenuInfo(arr, category) {
    const spicytxt = (spicy) => {
      return spicy
        .split('')
        .map((e) => `<i class="spicy_icon"></i>`)
        .join('')
    }
    const filterRst = menuBycategory(...arguments)
    return filterRst
      .map(
        (e) => `<div class="menu_item">
                  <div class="menu_itemTitleRow">
                    <h4 style="font-weight:bold;">${
                      e['Chinese name'] ? e['Chinese name'] : e.name
                    }</h4>
                    <div class="menu_itemTags">
                      <span class="spicy">${spicytxt(e.spicy)}</span>
                      <span>${e.price}</span>
                    </div>
                  </div>
                  ${e['Chinese name'] ? '<h4>' + e.name + '</h4>' : ''}
                  <div class="menu_itemDescription">${e.description}</div>
                </div>`
      )
      .join('')
  }
  function isInView(el) {
    const clientHeight = document.body.clientHeight
    let rect = el.getBoundingClientRect()
    let elTop = rect.top
    let elBottom = rect.bottom
    return elTop <= 200 && elBottom > 0
  }

  $(document).ready(function () {
    let raf = null
    window
      .fetch('./data.json')
      .then(function (response) {
        return response.json()
      })
      .then((res) => {
        const key = 'category chinese'
        let menus = res.map((e) => ({
          enName: `${e.category}`,
          znName: `${e[key]}`,
          mainCate: e.maincategory
        }))
        const menuList = uniqueFunc(menus, 'enName')
        const cates = uniqueFunc(menus, 'mainCate')
        console.log(cates, menuList)
        $('#navLink').html(
          cates.map(
            (e) => `<div class="categoryLink">
                <div>${e.mainCate}</div>
                <div class="subcategory">
                   ${menuList
                     .filter((menu) => menu.mainCate == e.mainCate)
                     .map(
                       (e) =>
                         `<a href="#${e.enName.trim()}${e.znName.trim()}">${
                           e.enName
                         } ${e.znName}</a>`
                     ).join('')}
                </div>
              </div>`
          )
        )
        $('#navlink_bottom').html(
          menuList.map(
            (e) => `<div class="categoryLink">
                <a href="#${e.enName.trim()}${e.znName.trim()}">${e.enName} ${
              e.znName
            }</a>
              </div>`
          )
        )
        // section
        const sections = menuList.map(
          (e) =>
            `<section id="${e.enName.trim()}${e.znName.trim()}" class="menu_category">
                <h2>
                  <div class="menu_categoryNameEn">${e.enName}</div>
                  <div class="menu_categoryNameZh">${e.znName}</div>
                </h2>
                <div class="menu_categoryItemsContainer">
                  <div class="menu_subCategory">
                    ${joinMenuInfo(res, e.enName)}
                  </div>
              </section>`
        )
        $('#main-body').html(sections.join(''))
        // nav click
        $('#navlink_bottom .categoryLink').click(() => {
          $(this).addClass('active').siblings().removeClass('active')
          window.lock = true
          const st = Date.now()
          window.cancelAnimationFrame(raf)
          const dealFlag = () => {
            const et = Date.now()
            const time = et - st
            if (time < 1000) {
              raf = window.requestAnimationFrame(dealFlag)
            } else {
              window.lock = false
              const rate =
                document.documentElement.scrollTop / document.body.scrollHeight
              const diff = rate * $('.menu_categoryNav_bottom')[0].scrollWidth
              $('.menu_categoryNav_bottom').scrollLeft(diff)
            }
          }
          raf = window.requestAnimationFrame(dealFlag)
        })
        window.onscroll = () => {
          const scrollTop = document.documentElement.scrollTop
          $('.menu_category').each((i, e) => {
            if (isInView(e)) {
              $('#navlink_bottom .categoryLink').removeClass('active')
              const dom = $('#navlink_bottom .categoryLink').eq(i)
              dom.addClass('active')
            }
          })
          const rate =
            document.documentElement.scrollTop / document.body.scrollHeight
          const diff = rate * $('.menu_categoryNav_bottom')[0].scrollWidth
          if (!window.lock) {
            $('.menu_categoryNav_bottom').scrollLeft(diff)
          }
        }
      })
    $('.menu-toggle').click(() => {
      const dom = $('.navlist.topmenu')
      if (dom.hasClass('toggled')) {
        dom.removeClass('toggled')
      } else {
        dom.addClass('toggled')
      }
    })
  })
</script>
